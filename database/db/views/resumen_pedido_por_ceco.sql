CREATE VIEW resumen_pedido_por_ceco AS
SELECT sp.sede_id,ceco.id as ceco_id,ceco.codigo AS codigo_ceco, ceco.descripcion AS ceco,sp.fecha_de_pedido_id,dsp.articulo_id,a.codigo,a.articulo,a.tipo,um.unidad_de_medida as unidad_de_medida,SUM(dsp.cantidad_validada) AS cantidad, ss.cantidad AS almacen, dsp.precio AS precio, (SUM(dsp.cantidad_validada)*dsp.precio) AS total FROM detalle_de_solicitud_de_pedidos dsp INNER JOIN solicitud_de_pedidos sp ON sp.id = dsp.solicitud_de_pedido_id INNER JOIN articulos a ON a.id = dsp.articulo_id INNER JOIN unidad_de_medidas um ON um.id = a.unidad_de_medida_id INNER JOIN stock_sedes ss ON ss.articulo_id = dsp.articulo_id AND ss.sede_id = sp.sede_id INNER JOIN implementos i ON i.id = sp.implemento_id INNER JOIN centro_de_costos ceco ON ceco.id = i.centro_de_costo_id WHERE dsp.estado = 'VALIDADO' GROUP BY dsp.articulo_id,sp.fecha_de_pedido_id,sp.sede_id,ceco.id
